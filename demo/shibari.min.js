(function(){function n(e){function r(){i(),t=JSON.parse(JSON.stringify(e))}function i(){_.each(n.generic,function(n){n(e,t)})}function s(e,t){_.each(n.create,function(n){n(e,t)})}function o(e,t,r){_.each(n.update,function(n){n(e,t,r)})}function u(e,t){_.each(n["delete"],function(n){n(e,t)})}function a(){var n=t.length,i=e.length;if(n!=i||JSON.stringify(t)!=JSON.stringify(e)){var a=Math.max(i,n)-1;for(var f=a;f>=0;f--){var l=t[f],c=e[f];f>n-1?s(c,f):f>i-1?u(l,f):_.isEqual(c,l)||o(c,l,f)}r()}}var t=[],n={generic:[],create:[],update:[],"delete":[]};return e.pop=function(){a();var e=Array.prototype.pop.apply(this,arguments),t=this.length;return u(e,t),r(),e},e.push=function(){a();var e=arguments[0],t=Array.prototype.push.apply(this,arguments);return s(e,t-1),r(),t},e.reverse=function(){a();for(var e=this.length-1;e>=0;e--)u(this[e],e);var t=Array.prototype.reverse.apply(this,arguments);return _.each(this,s),r(),t},e.shift=function(){a();var e=Array.prototype.shift.apply(this,arguments);return u(e,0),r(),e},e.sort=function(){a();for(var e=this.length-1;e>=0;e--)u(this[e],e);var t=Array.prototype.sort.apply(this,arguments);return _.each(this,s),r(),t},e.splice=function(e,t){a();var n=Array.prototype.slice.call(arguments,2),i=Array.prototype.splice.apply(this,arguments);for(var o=i.length-1;o>=0;o--)u(i[o],e+o);return _.each(n,function(t,n){s(t,e+n)}),r(),i},e.unshift=function(){a();var e=arguments[0],t=Array.prototype.unshift.apply(this,arguments);return s(e,0),r(),t},setInterval(a,250),{unbind:function(e,t){},bind:function(r,i){n[r].push(i),r=="generic"?i(e,t):r=="create"&&_.each(e,i),t=JSON.parse(JSON.stringify(e))}}}var e=[],t=[];_.mixin({observe:function(r,i,s){if(!_.isArray(r))throw"subject should be a array";_.isFunction(i)&&(s=i,i="generic");var o=_.indexOf(e,r);if(o==-1){o=e.length,e.push(r);var u=new n(r);t.push(u)}return t[o].bind(i,s),r},unobserve:function(e,t,n){return e}}),typeof jQuery!="undefined"&&typeof jQuery.fn.insertAt=="undefined"&&(jQuery.fn.insertAt=function(t,n){return t===0?this.prepend(n):t<this.length-1?$(this[t]).before(n):this.append(n),this})})(),"use strict",Object.observe||function(e,t){var n=function(e){var n=e.call(e),r=typeof r;return typeof t.alert=="object"?function(t){return n===e.call(t)||!!t&&typeof t.toString==r&&typeof t.valueOf==r&&/^\s*\bfunction\b/.test(""+t)}:function(t){return n===e.call(t)}}(e.prototype.toString),r=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},i=function(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t},s=function(e){return typeof e=="undefined"?!1:"get"in e||"set"in e},o=function(e){return typeof e=="undefined"?!1:"value"in e||"writable"in e},u=function(e,t){if(typeof e!="object")throw new TypeError("Object.observeObject called on non-object");if(n(t)===!1)throw new TypeError("Object.observeObject: Expecting function");if(Object.isFrozen(t)===!0)throw new TypeError("Object.observeObject: Expecting unfrozen function")},a=function(){var e=[],t=function(t,n){u(t,n),Object.getNotifier(t).addListener(n),e.indexOf(t)===-1?e.push(t):Object.getNotifier(t)._checkPropertyListing()};t.prototype.deliverChangeRecords=function(e){Object.getNotifier(e).deliverChangeRecords()},e.lastScanned=0;var n=function(e){return function(){var t=0,r=e.length,i=new Date,s=!1;for(t=e.lastScanned;t<r&&!s;t++)Object.getNotifier(e[t])._checkPropertyListing(),s=new Date-i>100;e.lastScanned=t<r?t:0,setTimeout(n,100)}}(e);return setTimeout(n,100),t}(),f=function(e){var t=[],n=[],o=!1,u=[],a=[],f=this;Object.defineProperty(f,"_watching",{get:function(e){return function(){return e}}(e)});var l=function(e,t){var n=typeof e[t],o=Object.getOwnPropertyDescriptor(e,t);if(t==="getNotifier"||s(o)||!o.enumerable)return!1;if(e instanceof Array&&r(t)){var f=u.length;return u[f]=t,a[f]=e[t],!0}return function(t,n){u[t]=n,a[t]=e[n],Object.defineProperty(e,n,{get:function(){return a[t]},set:function(r){i(a[t],r)||(Object.getNotifier(e).queueUpdate(e,n,"updated",a[t]),a[t]=r)}})}(u.length,t),!0};f._checkPropertyListing=function(e){var t=f._watching,n=Object.keys(t),i=0,s=n.length,o=[],c=u.slice(0),h=[],p,d=!e,v,m,g;for(i=0;i<s;i++)p=n[i],m=t[p],v=typeof m,(g=u.indexOf(p))===-1?l(t,p)&&d&&f.queueUpdate(t,p,"new",null,t[p]):(t instanceof Array&&r(p)&&a[g]!==m&&(d&&f.queueUpdate(t,p,"updated",a[g],m),a[g]=m),c.splice(c.indexOf(p),1));if(d){s=c.length;for(i=0;i<s;i++)g=u.indexOf(c[i]),f.queueUpdate(t,c[i],"deleted",a[g]),u.splice(g,1),a.splice(g,1)}},f.addListener=function(e){var n=t.indexOf(e);n===-1&&t.push(e)},f.removeListener=function(e){var n=t.indexOf(e);n>-1&&t.splice(n,1)},f.listeners=function(){return t},f.queueUpdate=function(e,t,n,r){this.queueUpdates([{type:n,object:e,name:t,oldValue:r}])},f.queueUpdates=function(e){var t=this,r=0,i=e.length||0,s;for(r=0;r<i;r++)s=e[r],n.push(s);o&&clearTimeout(o),o=setTimeout(function(){o=!1,t.deliverChangeRecords()},100)},f.deliverChangeRecords=function(){var e=0,r=t.length,i=!0;for(e=0;e<r&&i;e++)typeof t[e]=="function"&&(t[e]===console.log?console.log(n):i=!t[e](n));n=[]},f._checkPropertyListing(!0)},l=[],c=[];e.getNotifier=function(e){var t=c.indexOf(e),n=t>-1?l[t]:!1;return n||(t=c.length,c[t]=e,n=l[t]=new f(e)),n},e.observe=function(e,t){return new a(e,t)},e.unobserve=function(t,n){u(t,n),e.getNotifier(t).removeListener(n)}}(Object,this);var Shibari=function(){};Shibari.converters={},Shibari.BINDING_DIRECTION_TWO_WAY=0,Shibari.BINDING_DIRECTION_ONE_WAY=1,Shibari.BIND_ATTRIBUTES_PREFIX="data-bind-",Shibari.addConverter=function(e,t){Shibari.converters[e]=t},Shibari.getAttribute=function(e,t){return $(e).attr(t)},Shibari.setAttribute=function(e,t,n){$(e).attr(t,n)},Shibari.getInputValue=function(e){return $(e).val()},Shibari.setInputValue=function(e,t){$(e).val(t)},Shibari.getChildren=function(e){return $(e).children()},Shibari.setHTML=function(e,t){$(e).html(t)},Shibari.onChange=function(e,t){$(e).change(t)},Shibari.triggerEvent=function(e,t){$(e).trigger(t)},Shibari.getFirstChild=function(e){return $(e).children(0)},Shibari.clone=function(e){return $(e).clone()},Shibari.append=function(e,t){$(e).append(t)},Shibari.bind=function(e,t){if(!t)throw"Context does not exist";e.shibariContext=t;var n=e.attributes;if(n)for(var r=0;r<n.length;r++){var i=!1,s=null;n[r].name!=Shibari.BIND_ATTRIBUTES_PREFIX+"context"&&(n[r].name==Shibari.BIND_ATTRIBUTES_PREFIX+"content"?Shibari.bindContentToValue(e,n[r].name.substr(Shibari.BIND_ATTRIBUTES_PREFIX.length),t,Shibari.getAttribute(children[cel],n[r].name)):n[r].name==Shibari.BIND_ATTRIBUTES_PREFIX+"template"?(i=!0,s=Shibari.getAttribute(e,n[r].name)):n[r].name.indexOf(Shibari.BIND_ATTRIBUTES_PREFIX)==0&&Shibari.bindToValue(e,n[r].name.substr(Shibari.BIND_ATTRIBUTES_PREFIX.length),t,Shibari.getAttribute(e,n[r].name)));if(i){Shibari.bindTemplateToValue(e,n[r].name.substr(Shibari.BIND_ATTRIBUTES_PREFIX.length),t,s);return}}Shibari.bindChildren(e,t)},Shibari.bindChildren=function(e,t){var n=Shibari.getChildren(e);for(var r=0;r<n.length;r++){var i=n[r].attributes,s=t;if(i){var o=!1,u=null;for(var a=0;a<i.length;a++){if(i[a].name==Shibari.BIND_ATTRIBUTES_PREFIX+"context"){var f=t[Shibari.getAttribute(n[r],i[a].name)];if(!f)throw"Context does not exist";s=f}else i[a].name==Shibari.BIND_ATTRIBUTES_PREFIX+"content"?Shibari.bindContentToValue(n[r],i[a].name.substr(Shibari.BIND_ATTRIBUTES_PREFIX.length),t,Shibari.getAttribute(n[r],i[a].name)):i[a].name==Shibari.BIND_ATTRIBUTES_PREFIX+"template"?(o=!0,u=Shibari.getAttribute(n[r],i[a].name)):i[a].name.indexOf(Shibari.BIND_ATTRIBUTES_PREFIX)==0&&Shibari.bindToValue(n[r],i[a].name.substr(Shibari.BIND_ATTRIBUTES_PREFIX.length),t,Shibari.getAttribute(n[r],i[a].name));if(o){Shibari.bindTemplateToValue(n[r],i[a].name.substr(Shibari.BIND_ATTRIBUTES_PREFIX.length),t,u);return}}}s!=t?Shibari.getChildren(n[r]).length>0&&Shibari.bind(n[r],s):Shibari.getChildren(n[r]).length>0&&Shibari.bindChildren(n[r],s)}},Shibari.parseBindingData=function(e){if(e.indexOf(":")!=-1){var t=e.split(","),n={};for(var r=0;r<t.length;r++){var i=t[r].split(":");n[i[0]]=i[1]}var s={path:n.path,converter:null,direction:Shibari.BINDING_DIRECTION_TWO_WAY};return n.converter&&(s.converter=n.converter),n.direction&&(n.direction=="TwoWay"?s.direction=Shibari.BINDING_DIRECTION_TWO_WAY:n.direction=="OneWay"&&(s.direction=Shibari.BINDING_DIRECTION_ONE_WAY)),s}return{path:e,converter:null,direction:Shibari.BINDING_DIRECTION_TWO_WAY}},Shibari.evaluateToValue=function(e,t){if(t.converter!=null){var n=Shibari.converters[t.converter];return n.to(e[t.path])}return e[t.path]},Shibari.evaluateFromValue=function(e,t){if(t.converter!=null){var n=Shibari.converters[t.converter];return n.from(Shibari.getInputValue(e))}return Shibari.getInputValue(e)},Shibari.bindTemplateToValue=function(e,t,n,r){var i=Shibari.parseBindingData(r),s=n[i.path],o=Shibari.getFirstChild(e);Shibari.setHTML(e,"");var u=[];_.observe(s,"create",function(t,n){var r=Shibari.clone(o);Shibari.bind(r,t),u[n]===undefined?(Shibari.append(e,r),u.push({item:t,element:r})):($(r).insertBefore(u[n].element),u.splice(n,0,{item:t,element:r}))}),_.observe(s,"update",function(t,n,r){$(u[r].element).remove(),u.splice(r,1);var i=Shibari.clone(o);Shibari.bind(i,t),u[r]===undefined?(Shibari.append(e,i),u.push({item:t,element:i})):($(i).insertBefore(u[r].element),u.splice(r,0,{item:t,element:i}))}),_.observe(s,"delete",function(e,t){$(u[t].element).remove(),u.splice(t,1)})},Shibari.bindContentToValue=function(e,t,n,r){var i=Shibari.parseBindingData(r);Shibari.setHTML(e,Shibari.evaluateToValue(n,i)),Object.observe(n,function(t){Shibari.setHTML(e,Shibari.evaluateToValue(n,i))})},Shibari.bindToValue=function(e,t,n,r){var i=Shibari.parseBindingData(r),s=!1;e.nodeName=="INPUT"?(i.direction==Shibari.BINDING_DIRECTION_TWO_WAY&&t=="value"&&Shibari.onChange(e,function(){s?s=!1:(s=!0,n[i.path]=Shibari.evaluateFromValue(e,i))}),s=!0,Shibari.setAttribute(e,t,Shibari.evaluateToValue(n,i)),t=="value"&&Shibari.triggerEvent(e,"change"),Object.observe(n,function(r){for(var o=0;o<r.length;o++)r[o].name==i.path&&(s?s=!1:(s=!0,t=="value"?(Shibari.setInputValue(e,Shibari.evaluateToValue(n,i)),Shibari.triggerEvent(e,"change")):Shibari.setAttribute(e,t,Shibari.evaluateToValue(n,i))))})):(Shibari.setAttribute(e,t,Shibari.evaluateToValue(n,i)),Object.observe(n,function(r){for(var s=0;s<r.length;s++)r[s].name==i.path&&Shibari.setAttribute(e,t,Shibari.evaluateToValue(n,i))}))}